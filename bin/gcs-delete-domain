#!/usr/bin/env node

var CLI = require(__dirname + '/../lib/command-line').CommandLineInterface;
var commandLine = new CLI();

commandLine
  .usage('--domain-name <domain name> [options]')
  .option('-d, --domain-name <domain name>',
          'The name of the domain that you are deleting. Required.',
          String)
  .option('-f, --force',
          'Delete the domain without prompting for confirmation.')
  .parse();

commandLine.assertHaveDomainName();
commandLine.assertDomainExistsHTTP(function() {
  function doDelete(successMessage) {
    commandLine.configurationAPI.DeleteDomain(
      { DomainName: commandLine.domainName },
      function(error, response) {
        if (error)
          commandLine.raiseFatalError(error);
        console.log(successMessage);
        process.exit(0);
      }
    );
  }
  if (commandLine.options.force) {
    doDelete('Domain [' + commandLine.domainName + '] has been deleted successfully.');
  } else {
    commandLine.confirm('Really delete? [' + commandLine.domainName + '] (y/N) ', function(ok){
      if (ok) {
        doDelete('Successfully deleted.');
      } else {
        process.exit(1);
      }
    });
  }
});
